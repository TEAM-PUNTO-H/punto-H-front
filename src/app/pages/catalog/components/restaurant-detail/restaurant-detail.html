<div class="modal-backdrop" (click)="closeModal()">
  <div class="modal-box" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeModal()">âœ•</button>

    <div *ngIf="restaurant">
      <div class="hero" [style.background]=" 'linear-gradient(90deg,#fff,rgba(0,0,0,0.03))' ">
        <div class="emoji-big">{{ restaurant.emoji }}</div>
      </div>

      <div class="content">
        <div class="header">
          <div class="header-info">
            <h2>{{ restaurant.nombre }}</h2>
            <span class="status" [class.open]="restaurant.abierto">{{ restaurant.abierto ? 'ğŸŸ¢ Abierto' : 'ğŸ”´ Cerrado' }}</span>
          </div>
          <div class="header-actions">
            <button type="button"
                    class="favorite-btn"
                    [class.active]="isFavorite"
                    (click)="toggleFavorite($event)">
              <span class="icon">{{ isFavorite ? 'â¤ï¸' : 'ğŸ¤' }}</span>
              {{ isFavorite ? 'En favoritos' : 'Agregar a favoritos' }}
            </button>
            <div *ngIf="favoriteMessage" class="inline-feedback">{{ favoriteMessage }}</div>
          </div>
        </div>

        <p class="desc">{{ restaurant.descripcion }}</p>

        <div class="restaurant-info" *ngIf="restaurant.direccion || restaurant.telefono || restaurant.horario">
          <div class="info-item" *ngIf="restaurant.direccion">
            <span class="info-icon">ğŸ“</span>
            <span>{{ restaurant.direccion }}</span>
          </div>
          <div class="info-item" *ngIf="restaurant.telefono">
            <span class="info-icon">ğŸ“</span>
            <span>{{ restaurant.telefono }}</span>
          </div>
          <div class="info-item" *ngIf="restaurant.horario">
            <span class="info-icon">ğŸ•’</span>
            <span>{{ restaurant.horario }}</span>
          </div>
        </div>

        <div class="info-grid">
          <div>â­ <strong>{{ restaurant.calificacion }}</strong> <div class="muted">{{ restaurant.resenas }} reseÃ±as</div></div>
          <div>â± <strong>{{ restaurant.tiempoMin }}-{{ restaurant.tiempoMax }} min</strong><div class="muted">Tiempo</div></div>
          <div>ğŸšš <strong>{{ restaurant.costoEnvio===0 ? 'Gratis' : ('$'+restaurant.costoEnvio) }}</strong><div class="muted">EnvÃ­o</div></div>
        </div>

        <h3>MenÃº</h3>
        <div *ngFor="let cat of getMenuCategories()">
          <h4 class="cat">{{ cat }}</h4>
          <div class="dishes">
            <div *ngFor="let d of restaurant.menu[cat]" class="dish-row" [class.unavailable]="!d.disponible">
              <div class="left">
                <div class="dish-image-container">
                  <img 
                    *ngIf="isDishImage(d.imagen)" 
                    [src]="d.imagen" 
                    [alt]="d.nombre"
                    class="dish-image"
                    (error)="onDishImageError($event, d)">
                  <div *ngIf="!isDishImage(d.imagen)" class="dish-emoji">{{ d.imagen || 'ğŸ½ï¸' }}</div>
                </div>
                <div>
                  <div class="dish-name">{{ d.nombre }}</div>
                  <div class="muted small">{{ d.descripcion }}</div>
                  <div *ngIf="d.alergenos && d.alergenos.length > 0" class="muted small">âš ï¸ AlÃ©rgenos: {{ getAlergenosText(d.alergenos) }}</div>
                </div>
              </div>
              <div class="right">
                <div class="price">${{ d.precio }}</div>
                <button *ngIf="d.disponible" class="btn-add" (click)="openDishModal(d.id)">Agregar</button>
                <div *ngIf="!d.disponible" class="muted">No disponible</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Mensaje cuando el usuario es dueÃ±o del restaurante -->
        <div *ngIf="isOwnerOfRestaurant()" class="owner-message">
          <p>âš ï¸ No puedes comentar en tu propio restaurante. Puedes ver las reseÃ±as de otros usuarios a continuaciÃ³n.</p>
        </div>

        <!-- Formulario de reseÃ±a (solo visible si no es el dueÃ±o) -->
        <form *ngIf="!isOwnerOfRestaurant()" class="review-form" (ngSubmit)="submitReview()" #reviewForm="ngForm">
          <h4>Escribe tu reseÃ±a</h4>
          <div class="form-grid">
            <div class="input-group name-field">
              <label for="reviewName">Nombre</label>
              <input id="reviewName"
                     name="reviewName"
                     type="text"
                     [(ngModel)]="newReview.usuario"
                     placeholder="Tu nombre"
                     required />
            </div>
            <div class="input-group rating-field">
              <label for="reviewRating">CalificaciÃ³n</label>
              <select id="reviewRating"
                      name="reviewRating"
                      [(ngModel)]="newReview.calificacion">
                <option *ngFor="let star of [5,4,3,2,1]" [ngValue]="star">{{ star }} â­</option>
              </select>
            </div>
          </div>
          <div class="input-group">
            <label for="reviewComment">Comentario</label>
            <textarea id="reviewComment"
                      name="reviewComment"
                      rows="3"
                      [(ngModel)]="newReview.comentario"
                      placeholder="Comparte tu experiencia"
                      required></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-add wide">Enviar reseÃ±a</button>
          </div>
          <div *ngIf="reviewError" class="review-error">{{ reviewError }}</div>
          <div *ngIf="reviewFeedback && !reviewError" class="review-feedback">{{ reviewFeedback }}</div>
        </form>

        <app-restaurant-reviews [restaurant]="restaurant"></app-restaurant-reviews>
      </div>
    </div>
  </div>
</div>