<div class="reviews-favs">
  <div class="reviews-col">
    <div class="header-row">
      <h3>Mis Reseñas</h3><span class="muted">{{ reviews.length }} reseña{{ reviews.length !== 1 ? 's' : '' }}</span>
    </div>

    <div class="list">
      <div *ngFor="let r of reviews" class="card">
        <div class="card-head">
          <h4 *ngIf="!isEditing(r.id)">{{ r.title }}</h4>
          <input 
            *ngIf="isEditing(r.id)" 
            type="text" 
            [(ngModel)]="editedReview.title" 
            class="edit-input"
            placeholder="Título de la reseña"
          />
          <div class="actions">
            <ng-container *ngIf="!isEditing(r.id)">
              <button class="link" (click)="startEditing(r)">Editar</button>
              <button class="link danger" (click)="deleteReview(r.id)">Eliminar</button>
            </ng-container>
            <ng-container *ngIf="isEditing(r.id)">
              <button class="link" (click)="saveReview(r.id)">Guardar</button>
              <button class="link danger" (click)="cancelEditing()">Cancelar</button>
            </ng-container>
          </div>
        </div>
        <p class="muted small" *ngIf="!isEditing(r.id)">
          <span class="stars">{{ getStars(r.rating) }}</span> {{ r.date }}
        </p>
        <div *ngIf="isEditing(r.id)" class="edit-rating">
          <label class="rating-label">Calificación:</label>
          <select [(ngModel)]="editedReview.rating" class="rating-select">
            <option [value]="1">⭐ (1 estrella)</option>
            <option [value]="2">⭐⭐ (2 estrellas)</option>
            <option [value]="3">⭐⭐⭐ (3 estrellas)</option>
            <option [value]="4">⭐⭐⭐⭐ (4 estrellas)</option>
            <option [value]="5">⭐⭐⭐⭐⭐ (5 estrellas)</option>
          </select>
        </div>
        <p *ngIf="!isEditing(r.id)">{{ r.text }}</p>
        <textarea 
          *ngIf="isEditing(r.id)" 
          [(ngModel)]="editedReview.text" 
          class="edit-textarea"
          placeholder="Escribe tu reseña aquí..."
          rows="4"
        ></textarea>
      </div>
    </div>
  </div>

  <aside class="favs-col">
    <div class="header-row">
      <h3>Mis Favoritos</h3><span class="muted">{{ favorites.length }} restaurante{{ favorites.length !== 1 ? 's' : '' }}</span>
    </div>

    <div class="list">
      <div *ngFor="let f of favorites" class="card fav">
        <div class="fav-inner">
          <div class="fav-icon">{{ f.emoji }}</div>
          <div class="fav-content">
            <h4>{{ f.name }}</h4>
            <div class="fav-rating-section">
              <div class="fav-rating-main">
                <div class="fav-stars">
                  <span *ngFor="let i of [1,2,3,4,5]" class="star-icon">
                    <span *ngIf="i <= getStarRating(f).full" class="star-full">★</span>
                    <span *ngIf="i === getStarRating(f).full + 1 && getStarRating(f).half" class="star-half">
                      <span class="star-half-left">★</span>
                      <span class="star-half-right">☆</span>
                    </span>
                    <span *ngIf="i > getStarRating(f).full + (getStarRating(f).half ? 1 : 0)" class="star-empty">☆</span>
                  </span>
                </div>
                <span class="fav-rating-value">{{ getRatingAverage(f).toFixed(1) }}/5</span>
                <span class="fav-reviews-count">({{ getTotalReviews(f) }} {{ getTotalReviews(f) === 1 ? 'reseña' : 'reseñas' }})</span>
              </div>
              <div class="fav-rating-breakdown" *ngIf="getTotalReviews(f) > 0">
                <div class="breakdown-item" *ngFor="let star of [5,4,3,2,1]">
                  <span class="star-label">{{ star }}★</span>
                  <div class="breakdown-bar">
                    <div class="breakdown-fill" [style.width.%]="getRatingPercentage(f, star)"></div>
                  </div>
                  <span class="breakdown-percent">{{ getRatingPercentage(f, star) }}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="fav-actions">
          <button class="btn-orange-small" (click)="viewMenu(f)">Ver Menú</button>
        </div>
      </div>
      <div *ngIf="favorites.length === 0" class="muted small">
        Aún no tienes restaurantes favoritos.
      </div>
    </div>
  </aside>
</div>

